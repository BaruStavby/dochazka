<!DOCTYPE html>
<html lang="cs">
<head><meta charset="UTF-8"><title>Doch치zka</title></head>
<body>
    <h1>Doch치zka</h1>
    <button onclick="odhlasit()">Odhl치sit</button><br><br>
    <label>Zam캩stnanec:
        <select id="jmeno">
            <option>Jan Nov치k</option><option>Karel Dvo콏치k</option><option>Eva Mal치</option><option>Petr Velk칳</option><option>Lucie Hor치kov치</option><option>Martin 캛ern칳</option><option>Alena B칤l치</option><option>Tom치코 Zelen칳</option><option>Anna Modr치</option><option>Josef Fialov칳</option><option>Ivan Buletsa star코칤</option><option>Ivan Buletsa Mlad코칤</option><option>Korol Vladik</option>
        </select>
    </label><br><br>
    <button onclick="zaznam('start')">Start</button>
    <button onclick="zaznam('stop')">Stop</button>
    <button onclick="stahnoutExport()">游닌 Export do Excelu</button>
    <p id="vysledek"></p>

    <h2>游늶 Doch치zka</h2>
    <label>Filtr datum: <input type="date" id="datum"></label>
    <label>Hledat jm칠no: <input type="text" id="hledat"></label>
    <button onclick="nactiTabulku()">游댌 Filtrovat</button>
    <table border="1" id="tabulka">
        <thead><tr><th>Datum</th><th>캛as</th><th>Jm칠no</th><th>Akce</th><th>Mistr</th></tr></thead>
        <tbody></tbody>
    </table>

    <h2>游뎹 Souhrn pracovn칤 doby</h2>
    <button onclick="nactiSouhrn()">游늵 Zobraz souhrn</button>
    <table border="1" id="souhrn">
        <thead><tr><th>Zam캩stnanec</th><th>Odpracov치no (hod)</th></tr></thead>
        <tbody></tbody>
    </table>

    <script>
        function zaznam(akce) {
            const jmeno = document.getElementById("jmeno").value;
            fetch("/zaznam", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({jmeno, akce})
            })
            .then(res => res.json())
            .then(data => {
                if (data.status === "ok") {
                    document.getElementById("vysledek").innerText = `Z치znam ulo쬰n: ${data.zaznam.join(" | ")}`;
                    nactiTabulku();
                } else {
                    document.getElementById("vysledek").innerText = "Chyba: " + data.message;
                }
            });
        }

        function nactiTabulku() {
            const datum = document.getElementById("datum").value;
            const hledat = document.getElementById("hledat").value;
            let url = "/data?";
            if (datum) url += `datum=${datum}&`;
            if (hledat) url += `hledat=${hledat}`;

            fetch(url)
            .then(res => res.json())
            .then(data => {
                const tbody = document.querySelector("#tabulka tbody");
                tbody.innerHTML = "";
                data.forEach(z => {
                    const row = `<tr><td>${z.datum}</td><td>${z.cas}</td><td>${z.jmeno}</td><td>${z.akce}</td><td>${z.mistr}</td></tr>`;
                    tbody.innerHTML += row;
                });
            });
        }

        function nactiSouhrn() {
            fetch("/souhrn")
            .then(res => res.json())
            .then(data => {
                const tbody = document.querySelector("#souhrn tbody");
                tbody.innerHTML = "";
                data.forEach(z => {
                    const row = `<tr><td>${z.jmeno}</td><td>${z.hodin}</td></tr>`;
                    tbody.innerHTML += row;
                });
            });
        }

        function stahnoutExport() {
            window.location.href = "/export";
        }

        function odhlasit() {
            window.location.href = "/logout";
        }

        window.onload = nactiTabulku;
    </script>
</body>
</html>
